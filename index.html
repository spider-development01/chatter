<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .code-block {
            font-family: monospace; /* use monospace font for code */
        }
    </style>
</head>
<body>
    <div class="1">
        <h1 class="code-block">
            !pip install flask flask-socketio pyngrok <br>
            !pip install flask flask-socketio eventlet <br>
            !pip install pyngrok <br>
        </h1>
    </div>
    <br>
    <div class="1">
        <h1 class="code-block">
            !ngrok authtoken 2gx07k2dnZkMR8dqD4nxLvyOmLJ_6ZUVQ6exmRovj113uQJXz <br>
            !ngrok restart <br>
        </h1>
    </div>
    <div class="1">
        <h1 class="code-block">
            import os<br>
            from flask import Flask, session, request<br>
            from flask_socketio import SocketIO, send, emit<br>
            from pyngrok import ngrok<br><br>
            # Initialize Flask app and SocketIO<br>
            app = Flask(__name__)<br>
            app.config['SECRET_KEY'] = 'secret!'<br>
            socketio = SocketIO(app)<br><br>
            # Store chat messages<br>
            chat_history = []<br><br>
            # HTML template for the chat<br>
            chat_html = '''<br>
            &lt;!DOCTYPE html&gt;<br>
            &lt;html&gt;<br>
            &lt;head&gt;<br>
              &lt;meta charset=&quot;UTF-8&quot;&gt;<br>
              &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br>
              &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css&quot;&gt;<br>
              &lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.googleapis.com&quot;&gt;<br>
              &lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.gstatic.com&quot; crossorigin&gt;<br>
              &lt;link href=&quot;https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;500;600;700&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;<br>
              &lt;link href=&quot;https://unpkg.com/@bentoproject/core@0.2.3/dist/styles.css&quot; rel=&quot;stylesheet&quot;&gt;<br>
              &lt;title&gt;Spider-Chat&lt;/title&gt;<br>
              &lt;script src=&quot;https://cdn.socket.io/4.0.1/socket.io.min.js&quot;&gt;&lt;/script&gt;<br>
              &lt;style&gt;<br>
                body {<br>
                  font-family: &#39;Chakra Petch&#39;, sans-serif;<br>
                  margin: 0;<br>
                  display: flex;<br>
                  flex-direction: column;<br>
                  height: 100vh;<br>
                  background-color: #fef7dadc;<br>
                  color: #ffffff;<br>
                }<br>
                .chat-container {<br>
                  flex: 1;<br>
                  display: flex;<br>
                  flex-direction: column;<br>
                  padding: 10px;<br>
                }<br>
                #header {<br>
                  color: white;<br>
                  text-align: center;<br>
                  padding: 10px 0;<br>
                  font-size: 24px;<br>
                  position:sticky;<br>
                  top: 46px;<br>
                  z-index: 10000;<br>
                }<br>
                #hamburger {<br>
                  position: absolute;<br>
                  top: 50%;<br>
                  left: 10px;<br>
                  transform: translateY(-50%);<br>
                  cursor: pointer;<br>
                  z-index: 10000;<br>
                  width: 50px;<br>
                  height: 50px;<br>
                  display: flex;<br>
                  align-items: center;<br>
                  justify-content: center;<br>
                  border-radius: 50%;<br>
                  background: black;<br>
                  transition: all 0.3s ease;<br>
                }<br>
                .line {<br>
                  position: absolute;<br>
                  height: 2px;<br>
                  background-color: white;<br>
                  transition: all 0.3s ease;<br>
                }<br>
                .line1 {<br>
                  width: 20px;<br>
                  top: 40%;<br>
                }<br>
                .line2 {<br>
                  width: 10px;<br>
                  top: 60%;<br>
                }<br>
                #hamburger.open .line1 {<br>
                  transform: rotate(45deg);<br>
                  width: 20px;<br>
                  top: 50%;<br>
                }<br>
                #hamburger.open .line2 {<br>
                  transform: rotate(-45deg);<br>
                  width: 20px;<br>
                  top: 50%;<br>
                }<br>
                #messages {<br>
                  flex: 1;<br>
                  overflow-y: auto;<br>
                  margin: 10px 0;<br>
                }<br>
                .input-container {<br>
                  display: flex;<br>
                  padding: 10px 0;<br>
                }<br>
                #myMessage {<br>
                  flex: 1;<br>
                  padding: 10px;<br>
                  border: 1px solid #333;<br>
                  border-radius: 40px;<br>
                  margin-right: 10px;<br>
                  background: #1e1e1e;<br>
                  color: #fff;<br>
                }<br>
                #sendbutton {<br>
                  background: linear-gradient(135deg, #d7d1b7, #000);<br>
                  color: white;<br>
                  border: none;<br>
                  padding: 10px;<br>
                  border-radius: 4px;<br>
                  cursor: pointer;<br>
                }<br>
                .navbar {<br>
                  background-color: #000000;<br>
                  border-left: 1px solid #333;<br>
                  position: fixed;<br>
                  bottom: -100%;<br>
                  width: 100%;<br>
                  height: 82%;<br>
                  transition: bottom ease-in-out 0.3s;<br>
                  z-index: 1000;<br>
                  border-radius: 50px;<br>
                  border-bottom-left-radius: 0;<br>
                  border-bottom-right-radius: 0;<br>
                  color: #fef7da;<br>
                }<br>
                .navbar.open {<br>
                  bottom: 0;<br>
                }<br>
                h2{<br>
                  color: #fef7da;<br>
                }<br>
                .navbar h2 {<br>
                  text-align: center;<br>
                  padding: 10px 0;<br>
                  margin: 10px;<br>
                  z-index: 1000;<br>
                  text-align: center;<br>
                  padding: 20px;<br>
                  margin-top: 20px;<br>
                  border:3px solid #fef7da;<br>
                  border-radius: 50px;<br>
                  color: #fef7da;<br>
                  font-size: 22px;<br>
                  font-weight: 700;<br>
                }<br>
                #userList {<br>
                  list-style: none;<br>
                  padding: 0;<br>
                  margin: 0;<br>
                }<br>
                #userList li {<br>
                  padding: 10px;<br>
                  cursor: pointer;<br>
                  border-bottom: 1px solid #333;<br>
                  color: #fff;<br>
                }<br>
                .message {<br>
                  display: flex;<br>
                  align-items: center;<br>
                  margin-bottom: 10px;<br>
                }<br>
                .message .profile-pic {<br>
                  width: 40px;<br>
                  height: 40px;<br>
                  margin-right: 10px;<br>
                }<br>
                .message .profile-pic img {<br>
                  width: 100%;<br>
                  border-radius: 50%;<br>
                }<br>
                .message-content {<br>
                  background: #000;<br>
                  padding: 10px;<br>
                  border-radius: 20px;<br>
                  max-width: 80%;<br>
                  position: relative;<br>
                  border-top-left-radius: 0;<br>
                }<br>
                .message-content::after {<br>
                  content: &quot;&quot;;<br>
                  position: absolute;<br>
                  top: 0;<br>
                  left: -10px;<br>
                  width: 0;<br>
                  height: 0;<br>
                  border-top: 10px solid transparent;<br>
                  border-right: 10px solid #000;<br>
                }<br>
              &lt;/style&gt;<br>
            &lt;/head&gt;<br>
            &lt;body&gt;<br>
            &lt;div class=&quot;chat-container&quot;&gt;<br>
            &lt;div id=&quot;header&quot;&gt;Spider Chat&lt;/div&gt;<br>
            &lt;div id=&quot;hamburger&quot;&gt;<br>
            &lt;div class=&quot;line line1&quot;&gt;&lt;/div&gt;<br>
            &lt;div class=&quot;line line2&quot;&gt;&lt;/div&gt;<br>
            &lt;/div&gt;<br>
            &lt;div class=&quot;navbar&quot;&gt;<br>
            &lt;h2&gt;Connected Users&lt;/h2&gt;<br>
            &lt;ul id=&quot;userList&quot;&gt;&lt;/ul&gt;<br>
            &lt;/div&gt;<br>
            &lt;div id=&quot;messages&quot;&gt;&lt;/div&gt;<br>
            &lt;div class=&quot;input-container&quot;&gt;<br>
            &lt;input type=&quot;text&quot; id=&quot;myMessage&quot; placeholder=&quot;Type your message here&quot; /&gt;<br>
            &lt;button id=&quot;sendbutton&quot;&gt;Send&lt;/button&gt;<br>
            &lt;/div&gt;<br>
            &lt;/div&gt;<br>
            &lt;script&gt;<br>
            document.addEventListener(&quot;DOMContentLoaded&quot;, function () {<br>
              var socket = io.connect(&#39;http://localhost:5000&#39;);<br><br>
              const hamburger = document.getElementById(&#39;hamburger&#39;);<br>
              const navbar = document.querySelector(&#39;.navbar&#39;);<br>
              const userList = document.getElementById(&#39;userList&#39;);<br><br>
              hamburger.addEventListener(&#39;click&#39;, function () {<br>
                navbar.classList.toggle(&#39;open&#39;);<br>
                hamburger.classList.toggle(&#39;open&#39;);<br>
              });<br><br>
              function addMessage(message) {<br>
                var messagesDiv = document.getElementById(&quot;messages&quot;);<br>
                var newMessage = document.createElement(&quot;div&quot;);<br>
                newMessage.className = &quot;message&quot;;<br>
                newMessage.innerHTML =<br>
                  &#39;&lt;div class=&quot;profile-pic&quot;&gt;&lt;img src=&quot;https://i.pravatar.cc/40&quot; alt=&quot;Profile Picture&quot;&gt;&lt;/div&gt;&#39; +<br>
                  &#39;&lt;div class=&quot;message-content&quot;&gt;&#39; + message + &#39;&lt;/div&gt;&#39;;<br>
                messagesDiv.appendChild(newMessage);<br>
                messagesDiv.scrollTop = messagesDiv.scrollHeight;<br>
              }<br><br>
              socket.on(&quot;connect&quot;, function () {<br>
                var username = prompt(&quot;Enter your username:&quot;);<br>
                socket.emit(&quot;join&quot;, username);<br>
              });<br><br>
              socket.on(&quot;message&quot;, function (data) {<br>
                addMessage(data);<br>
              });<br><br>
              document.getElementById(&quot;sendbutton&quot;).addEventListener(&quot;click&quot;, function () {<br>
                var messageInput = document.getElementById(&quot;myMessage&quot;);<br>
                var message = messageInput.value;<br>
                socket.emit(&quot;send_message&quot;, message);<br>
                messageInput.value = &quot;&quot;;<br>
              });<br><br>
              socket.on(&quot;user_list&quot;, function (users) {<br>
                userList.innerHTML = &quot;&quot;;<br>
                users.forEach(function (user) {<br>
                  var li = document.createElement(&quot;li&quot;);<br>
                  li.textContent = user;<br>
                  userList.appendChild(li);<br>
                });<br>
              });<br>
            });<br>
            &lt;/script&gt;<br>
            &lt;/body&gt;<br>
            &lt;/html&gt;<br>
            '''<br><br>
users = {}<br>
user_order = []<br>
<br>
@app.route('/')<br>
def chat():<br>
    return chat_html<br>
<br>
@socketio.on('connect')<br>
def handle_connect():<br>
    session['id'] = request.sid<br>
    user_order.append(request.sid)<br>
    print(f'{request.sid} connected')<br>
<br>
@socketio.on('disconnect')<br>
def handle_disconnect():<br>
    user_id = session.get('id')<br>
    if user_id in users:<br>
        print(f'{users[user_id]["username"]} disconnected')<br>
        del users[user_id]<br>
        user_order.remove(user_id)<br>
        emit_user_list()<br>
<br>
@socketio.on('set_username')<br>
def set_username(data):<br>
    user_id = session.get('id')<br>
    if user_id:<br>
        username = data['username']<br>
        users[user_id] = {<br>
            'username': username<br>
        }<br>
        print(f'{username} has joined the chat')<br>
        emit_user_list()<br>
<br>
@socketio.on('message')<br>
def handle_message(data):<br>
    user_id = session.get('id')<br>
    username = users.get(user_id, {}).get('username', 'Unknown')<br>
<br>
    message_data = {<br>
        'username': username,<br>
        'msg': data['msg'],<br>
        'align': 'right' if data['to'] else 'left',<br>
        'to': None<br>
    }<br>
<br>
    if data['to']:<br>
        recipient_id = data['to']<br>
        recipient_username = users.get(recipient_id, {}).get('username', 'Unknown')<br>
        message_data['to'] = recipient_username<br>
        emit('message', message_data, room=recipient_id)<br>
        emit('message', message_data, room=user_id)<br>
    else:<br>
        send(message_data, broadcast=True)<br>
<br>
    # Store the message in chat history<br>
    chat_history.append(message_data)<br>
<br>
@socketio.on('get_chat_history')<br>
def handle_get_chat_history():<br>
    emit('chat_history', {'messages': chat_history})<br>
<br>
def emit_user_list():<br>
    user_list = [{'id': user_id, 'username': users[user_id]['username']}] for user_id in users]<br>
    emit('user_list', {'users': user_list}, broadcast=True)<br>
<br>
# Start ngrok to expose the app<br>
url = ngrok.connect(5000)<br>
print(' * Tunnel URL:', url)<br>
<br>
if __name__ == '__main__':<br>
    socketio.run(app, port=5000, allow_unsafe_werkzeug=True)<br>
        </h1>
    </div>
    <br>
    <br>
</body>
</html>
